
# ğŸ¯ æŠ–éŸ³è¯„è®ºæ•°æ®é¢„å¤„ç†æ¨¡å—ç®—æ³•æ–‡æ¡£

## ä¸€ã€æ¨¡å—ç›®æ ‡

æœ¬æ¨¡å—æ—¨åœ¨å¯¹æ¥è‡ª `douyin_aweme_comment` è¡¨çš„åŸå§‹è¯„è®ºæ•°æ®è¿›è¡Œæ ‡å‡†åŒ–æ¸…æ´—ä¸ç»“æ„åŒ–å¤„ç†ï¼Œæ„å»ºå¯ä¾›åç»­æƒ…æ„Ÿåˆ†æã€ä»ä¼—è¡Œä¸ºå»ºæ¨¡çš„ç»Ÿä¸€æ•°æ®é›†ã€‚

æ¨¡å—ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

1. æ•°æ®åŠ è½½ä¸å­—æ®µæ ‡å‡†åŒ–ï¼›
    
2. è¯„è®ºæ–‡æœ¬æ¸…æ´—ï¼›
    
3. æ—¶é—´æ ¼å¼è½¬åŒ–ï¼›
    
4. è¯„è®ºæ ‘ï¼ˆçˆ¶å­å±‚çº§ï¼‰æ„å»ºï¼›
    
5. æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º JSONï¼›
    
6. æ”¯æŒçµæ´»å‚æ•°é…ç½®ï¼ˆå¦‚æœ€å°é•¿åº¦ã€åœç”¨è¯è¡¨ç­‰ï¼‰ã€‚
    

---

## äºŒã€æ•°æ®è¾“å…¥

### æ•°æ®æ¥æº

æ¥è‡ª MySQL æ•°æ®è¡¨ `douyin_aweme_comment`ï¼Œç¤ºä¾‹å­—æ®µå¦‚ä¸‹ï¼š

| å­—æ®µå                 | è¯´æ˜              |
| ------------------- | --------------- |
| `id`                | è‡ªå¢ä¸»é”®            |
| `comment_id`        | è¯„è®ºå”¯ä¸€æ ‡è¯†ç¬¦         |
| `aweme_id`          | è§†é¢‘ID            |
| `parent_comment_id` | çˆ¶è¯„è®ºIDï¼ˆä¸ºç©ºåˆ™ä¸ºä¸€çº§è¯„è®ºï¼‰ |
| `content`           | è¯„è®ºæ–‡æœ¬å†…å®¹          |
| `create_time`       | è¯„è®ºæ—¶é—´æˆ³ï¼ˆUnixç§’çº§ï¼‰   |
| `like_count`        | ç‚¹èµæ•°é‡ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰     |
| `sub_comment_count` | å­è¯„è®ºæ•°            |
| `user_id`           | ç”¨æˆ·ID            |
| `nickname`          | ç”¨æˆ·æ˜µç§°            |
| `user_signature`    | ç”¨æˆ·ä¸ªæ€§ç­¾å          |
| `ip_location`       | IPå±åœ°            |
| ...                 | å…¶ä½™ä¿ç•™å­—æ®µ          |

### SQL æŸ¥è¯¢

```sql
SELECT
    id, comment_id, aweme_id, parent_comment_id, content, create_time,
    like_count, sub_comment_count, user_id, nickname, user_signature, ip_location
FROM douyin_aweme_comment
WHERE content IS NOT NULL;
```

---

## ä¸‰ã€å¤„ç†æµç¨‹æ¦‚è¿°

```
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  æ•°æ®åŠ è½½   â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  æ•°æ®æ¸…æ´—   â”‚
            â”‚ (å»å™ª/ç©ºå€¼) â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  æ–‡æœ¬å¤„ç†   â”‚
            â”‚ (åˆ†è¯/å»åœç”¨)â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ æ—¶é—´æ ¼å¼åŒ–  â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ è¯„è®ºæ ‘æ„å»º  â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ JSONå¯¼å‡º    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€ç®—æ³•è®¾è®¡ä¸å®ç°æ­¥éª¤

### Step 1. æ•°æ®åŠ è½½

- ä½¿ç”¨ `pandas.read_sql` ä» MySQL æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼›
    
- æ‰€æœ‰å­—æ®µå‡ä¿ç•™ï¼ˆåŒ…æ‹¬ `ip_location`ã€`avatar`ã€`user_signature` ç­‰ï¼‰ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼›
    
- è‡ªåŠ¨å°† `like_count`ã€`sub_comment_count` è½¬æ¢ä¸º `int`ã€‚
    

```python
import pandas as pd
from sqlalchemy import create_engine

engine = create_engine("mysql+pymysql://user:password@localhost:3306/dbname")
df = pd.read_sql("""
SELECT * FROM douyin_aweme_comment WHERE content IS NOT NULL
""", engine)
```

---

### Step 2. æ•°æ®æ¸…æ´—

#### 2.1 åˆ é™¤æ— æ•ˆå†…å®¹

è¿‡æ»¤ç©ºå­—ç¬¦ä¸²ã€ä»…åŒ…å«è¡¨æƒ…/ç©ºæ ¼/å¹¿å‘Šçš„è¯„è®ºï¼š

```python
df = df[df['content'].str.strip().str.len() > min_length]
```

å‚æ•°ï¼š

- `min_length`: é»˜è®¤ `2`ï¼ˆå¯åœ¨é…ç½®æ–‡ä»¶ä¸­è°ƒæ•´ï¼‰
    

#### 2.2 å»é™¤åƒåœ¾ä¿¡æ¯

å¯å®šä¹‰é»‘åå•æˆ–å¹¿å‘Šå…³é”®è¯ï¼š

```python
ban_words = ['å…³æ³¨æˆ‘', 'ç‚¹å‡»', 'é“¾æ¥', 'å¹¿å‘Š', 'ä»£è´­']
df = df[~df['content'].apply(lambda x: any(w in x for w in ban_words))]
```

---

### Step 3. æ–‡æœ¬é¢„å¤„ç†ï¼ˆjieba åˆ†è¯ï¼‰

1. ä½¿ç”¨ `jieba.lcut()` åˆ†è¯ï¼›
    
2. å»é™¤åœç”¨è¯ï¼›
    
3. æ”¯æŒè‡ªå®šä¹‰åœç”¨è¯è¡¨è·¯å¾„ä¸è¯å…¸æ‰©å±•ã€‚
    

```python
import jieba

stopwords = set(open("stopwords.txt", encoding='utf8').read().splitlines())

def clean_text(text):
    words = jieba.lcut(text)
    return [w for w in words if w not in stopwords and len(w.strip()) > 1]

df['tokens'] = df['content'].apply(clean_text)
```

---

### Step 4. æ—¶é—´æ ¼å¼åŒ–

å°† Unix æ—¶é—´æˆ³è½¬åŒ–ä¸ºå¯è¯»æ ¼å¼ï¼š

```python
import datetime

df['datetime'] = df['create_time'].apply(
    lambda t: datetime.datetime.fromtimestamp(int(t)).strftime('%Y-%m-%d %H:%M:%S')
)
```

---

### Step 5. è¯„è®ºæ ‘æ„å»ºç®—æ³•

**æ€è·¯ï¼š**  
æ¯æ¡è¯„è®ºæ ¹æ® `parent_comment_id` å½’ç±»åˆ°å…¶çˆ¶èŠ‚ç‚¹ä¸‹ï¼›è‹¥ä¸ºç©ºåˆ™ä¸ºæ ¹è¯„è®ºã€‚

```python
from collections import defaultdict

def build_comment_tree(df):
    tree = defaultdict(list)
    for _, row in df.iterrows():
        parent = row['parent_comment_id'] or 'root'
        tree[parent].append(row.to_dict())
    return tree
```

æ„å»ºåæ ¼å¼ï¼š

```json
{
  "root": [
    {
      "comment_id": "12345",
      "content": "å“ˆå“ˆå“ˆå¤ªå¥½ç¬‘äº†",
      "children": [
        {"comment_id": "54321", "content": "ç¡®å®å“ˆå“ˆå“ˆå“ˆ"}
      ]
    }
  ]
}
```

---

### Step 6. æ•°æ®è¾“å‡º

å°†æ¯ä¸ªè§†é¢‘ (`aweme_id`) çš„è¯„è®ºæ ‘åˆ†åˆ«è¾“å‡ºä¸º JSON æ–‡ä»¶ï¼š
æ–‡ä»¶å‘½åæ ¼å¼æ˜¯è§†é¢‘id+æ—¶é—´æˆ³.json

```python
import json
import os

output_dir = "./processed_json"
os.makedirs(output_dir, exist_ok=True)

for aweme_id, group in df.groupby('aweme_id'):
    comment_tree = build_comment_tree(group)
    with open(f"{output_dir}/{aweme_id}.json", "w", encoding="utf8") as f:
        json.dump(comment_tree, f, ensure_ascii=False, indent=2)
```

---

## äº”ã€æ¨¡å—å‚æ•°é…ç½®ï¼ˆé›†ä¸­ç®¡ç†ï¼‰

æ‰€æœ‰å‚æ•°å¯ç»Ÿä¸€é…ç½®åœ¨ `config.yaml`ï¼š

```yaml
text:
  min_length: 2
  stopwords_path: "stopwords.txt"
  jieba_dict: "userdict.txt"
filter:
  stopwords: ["å…³æ³¨æˆ‘", "å¹¿å‘Š", "ä»£è´­"]
output:
  json_path: "./processed_json"
```

---

## å…­ã€è¾“å‡ºç»“æ„è¯´æ˜

æ¯ä¸ªè§†é¢‘å¯¹åº”ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œå­—æ®µåŒ…æ‹¬ï¼š

|å­—æ®µ|ç±»å‹|è¯´æ˜|
|---|---|---|
|`comment_id`|str|è¯„è®ºå”¯ä¸€ID|
|`parent_comment_id`|str|çˆ¶è¯„è®ºID|
|`content`|str|åŸå§‹æ–‡æœ¬|
|`tokens`|list|åˆ†è¯ç»“æœ|
|`datetime`|str|æ ¼å¼åŒ–æ—¶é—´|
|`like_count`|int|ç‚¹èµæ•°|
|`user_id`|str|ç”¨æˆ·ID|
|`nickname`|str|æ˜µç§°|
|`ip_location`|str|IPå±åœ°|
|`children`|list|å­è¯„è®º|


---

## å…«ã€ç¤ºä¾‹è¾“å‡º

```json
{
  "root": [
    {
      "comment_id": "c001",
      "content": "å¤ªæç¬‘äº†å“ˆå“ˆå“ˆ",
      "tokens": ["å¤ª", "æç¬‘", "å“ˆå“ˆå“ˆ"],
      "datetime": "2025-10-18 15:23:11",
      "like_count": 123,
      "ip_location": "å¹¿ä¸œ",
      "children": [
        {
          "comment_id": "c002",
          "content": "ç¡®å®",
          "tokens": ["ç¡®å®"],
          "datetime": "2025-10-18 15:30:05",
          "like_count": 12
        }
      ]
    }
  ]
}
```
