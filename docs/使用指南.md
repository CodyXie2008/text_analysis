# 文本分析模块使用指南

## 📋 快速开始

### 1. 环境准备

#### 系统要求
- Python 3.8+
- 8GB+ 内存（推荐）
- 稳定的网络连接（用于API调用）

#### 依赖安装
```bash
# 安装核心依赖
pip install pandas numpy scikit-learn jieba requests

# 安装可选依赖（用于可视化）
pip install matplotlib seaborn plotly
```

### 2. API配置

#### 阿里云API配置
```bash
# 复制环境变量示例文件
cp text_analysis/core/.env.example text_analysis/core/.env

# 编辑配置文件
nano text_analysis/core/.env
```

在`.env`文件中填入你的阿里云API密钥：
```bash
# 阿里云API配置
NLP_AK_ENV=your_access_key_id_here
NLP_SK_ENV=your_access_key_secret_here
NLP_REGION_ENV=cn-hangzhou
```

#### 获取API密钥
1. 登录阿里云控制台
2. 进入自然语言处理服务
3. 创建AccessKey
4. 获取AccessKey ID和AccessKey Secret

## 🚀 基本使用流程

### 步骤1: 数据清洗
```bash
# 进入项目目录
cd text_analysis

# 运行数据清洗
python text_analysis_unified.py cleaning --video-id 7306437681045654834 --limit 100
```

### 步骤2: 综合分析（推荐）
```bash
# 一键运行完整的从众心理分析
python text_analysis_unified.py conformity --use-cleaned-data --video-id 7306437681045654834
```

### 步骤3: 查看结果
- **控制台输出**: 实时显示分析进度和结果摘要
- **JSON文件**: `modules/data/comprehensive_conformity_analysis_*.json`
- **日志文件**: 详细的执行日志

## 📊 分析模式详解

### 1. 综合分析模式（推荐）

#### 特点
- 一键运行所有分析模块
- 生成综合从众心理分数
- 提供完整的分析报告

#### 使用示例
```bash
# 基本用法
python text_analysis_unified.py conformity --use-cleaned-data --video-id 7306437681045654834

# 测试模式（少量数据，快速验证）
python text_analysis_unified.py conformity --use-cleaned-data --test

# 不保存结果文件
python text_analysis_unified.py conformity --use-cleaned-data --no-save

# 不生成报告
python text_analysis_unified.py conformity --use-cleaned-data --no-report
```

#### 输出结果
- **综合分数**: 0-1之间的数值，表示整体从众心理程度
- **等级评估**: 极高/高/中等/低/极低从众心理
- **维度分析**: 时间、情感、相似度、点赞四个维度的详细分数
- **分析建议**: 基于结果的智能建议

### 2. 单独模块分析

#### 时间从众心理分析
```bash
python text_analysis_unified.py time --use-cleaned-data --video-id 7306437681045654834
```
- **分析内容**: 评论时间间隔、响应速度、时间从众模式
- **适用场景**: 研究用户行为时间模式

#### 情感从众心理分析
```bash
python text_analysis_unified.py sentiment --use-cleaned-data --video-id 7306437681045654834
```
- **分析内容**: 情感一致性、情感传播、情感从众程度
- **适用场景**: 情感传播研究、舆情分析

#### 相似度从众心理分析
```bash
python text_analysis_unified.py similarity --use-cleaned-data --video-id 7306437681045654834
```
- **分析内容**: 文本相似度、内容模仿、表达方式从众
- **适用场景**: 内容模仿分析、创意传播研究

#### 点赞从众心理分析
```bash
python text_analysis_unified.py like --use-cleaned-data --video-id 7306437681045654834
```
- **分析内容**: 点赞行为、互动从众、社交影响力
- **适用场景**: 社交行为研究、影响力分析

## 🔧 高级配置

### 1. 数据源配置

#### 使用清洗数据（推荐）
```bash
# 自动查找清洗数据文件
python text_analysis_unified.py conformity --use-cleaned-data

# 指定清洗数据文件路径
python text_analysis_unified.py conformity --cleaned-data-path modules/data/cleaned/parent_7306470754056569635_cleaned.json
```

#### 使用原始数据
```bash
# 直接使用原始数据（会自动进行数据清洗）
python text_analysis_unified.py conformity --video-id 7306437681045654834
```

### 2. 性能优化配置

#### 限制分析数量
```bash
# 限制分析100条评论
python text_analysis_unified.py conformity --use-cleaned-data --limit 100

# 测试模式（默认10条）
python text_analysis_unified.py conformity --use-cleaned-data --test
```

#### 批量处理
```bash
# 处理多个视频ID
for video_id in 7306437681045654834 7306437681045654835 7306437681045654836; do
    python text_analysis_unified.py conformity --use-cleaned-data --video-id $video_id
done
```

### 3. 输出控制

#### 控制输出文件
```bash
# 不保存结果文件
python text_analysis_unified.py conformity --use-cleaned-data --no-save

# 不生成分析报告
python text_analysis_unified.py conformity --use-cleaned-data --no-report

# 不创建可视化图表
python text_analysis_unified.py conformity --use-cleaned-data --no-viz
```

## 📈 结果解读

### 1. 综合从众心理分数

| 分数范围 | 等级 | 含义 | 建议 |
|---------|------|------|------|
| 0.8-1.0 | 极高从众心理 | 用户高度从众，行为高度一致 | 关注群体影响，注意信息茧房 |
| 0.6-0.8 | 高从众心理 | 用户较容易从众，有一定一致性 | 适合群体营销，注意引导 |
| 0.4-0.6 | 中等从众心理 | 用户部分从众，行为相对独立 | 平衡群体和个人需求 |
| 0.2-0.4 | 低从众心理 | 用户较少从众，行为相对独立 | 关注个体差异，个性化服务 |
| 0.0-0.2 | 极低从众心理 | 用户几乎不从众，行为高度独立 | 重视个体需求，避免群体压力 |

### 2. 各维度分数解读

#### 时间从众心理
- **高分**: 用户会快速响应，形成时间聚集
- **低分**: 用户响应时间分散，时间独立性高

#### 情感从众心理
- **高分**: 用户情感表达高度一致
- **低分**: 用户情感表达多样化

#### 相似度从众心理
- **高分**: 用户表达方式相似，内容模仿度高
- **低分**: 用户表达方式多样化，创意性强

#### 点赞从众心理
- **高分**: 用户点赞行为从众，受他人影响大
- **低分**: 用户点赞行为独立，基于个人判断

## 🛠️ 故障排除

### 1. 常见问题

#### API调用失败
```
ERROR: [AliyunAPI] 请求失败: HTTPSConnectionPool(host='alinlp.cn-hangzhou.aliyuncs.com', port=443): Read timed out
```
**解决方案**:
- 检查网络连接
- 验证API密钥配置
- 检查API配额和限制

#### 数据文件不存在
```
ERROR: 未找到清洗后的数据文件
```
**解决方案**:
- 先运行数据清洗: `python text_analysis_unified.py cleaning --video-id YOUR_VIDEO_ID`
- 检查文件路径是否正确
- 确认数据文件格式

#### 内存不足
```
ERROR: MemoryError: Unable to allocate array
```
**解决方案**:
- 使用`--limit`参数限制数据量
- 使用`--test`模式进行小规模测试
- 增加系统内存或使用更高配置的机器

### 2. 调试模式

#### 启用详细日志
```bash
# 设置日志级别
export PYTHONPATH=$PYTHONPATH:.
python -u text_analysis_unified.py conformity --use-cleaned-data --test
```

#### 检查中间结果
```bash
# 查看数据清洗结果
ls modules/data/cleaned/

# 查看分析结果
ls modules/data/*conformity*
```

## 📚 最佳实践

### 1. 数据准备
- 确保数据质量，先进行数据清洗
- 根据研究需求选择合适的分析规模
- 保存中间结果，便于后续分析

### 2. 分析策略
- 优先使用综合分析模式获得整体评估
- 根据具体需求选择单独模块进行深入分析
- 结合多个维度结果进行综合判断

### 3. 结果应用
- 结合业务场景解读分析结果
- 关注异常值和特殊模式
- 定期更新分析，跟踪变化趋势

### 4. 性能优化
- 使用测试模式验证配置
- 合理设置数据量限制
- 利用缓存机制避免重复计算

## 🔗 相关资源

### 文档链接
- [综合分析算法详解.md](./综合分析算法详解.md)
- [数据清洗算法详解.md](./数据清洗算法详解.md)
- [从众心理时间分析算法详解.md](./从众心理时间分析算法详解.md)
- [情感从众心理分析算法详解.md](./情感从众心理分析算法详解.md)
- [相似度从众心理分析算法详解.md](./相似度从众心理分析算法详解.md)
- [点赞从众心理分析算法详解.md](./点赞从众心理分析算法详解.md)

### 技术支持
- 查看项目README.md了解最新功能
- 提交Issue报告问题或建议
- 参考示例数据了解数据格式

---

*使用指南 v5.0.0 - 2025-09-07*
