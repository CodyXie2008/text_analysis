# æŠ–éŸ³è¯„è®ºæ•°æ®æ¸…æ´—ç®—æ³•è§„åˆ™è¯¦è§£

## æ¦‚è¿°
æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†`data_preparation_and_cleaning.py`ä¸­å®ç°çš„æ‰€æœ‰æ•°æ®æ¸…æ´—ç®—æ³•å’Œè§„åˆ™ï¼ŒåŒ…æ‹¬æ•°æ®å‡†å¤‡ã€è¿‡æ»¤ã€æ¸…æ´—å’Œé¢„å¤„ç†ç­‰å„ä¸ªé˜¶æ®µçš„å…·ä½“å®ç°ã€‚

## ä¸€ã€æ•´ä½“æµç¨‹æ¶æ„

### 1.1 å¤„ç†é˜¶æ®µåˆ’åˆ†
```
ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®å‡†å¤‡ï¼ˆæå–åŸå§‹æ•°æ®ï¼‰
    â†“
ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®è¿‡æ»¤ï¼ˆåƒåœ¾è¯„è®ºè¿‡æ»¤ï¼‰
    â†“
ç¬¬ä¸‰é˜¶æ®µï¼šæ•°æ®æ¸…æ´—ï¼ˆæ–‡æœ¬é¢„å¤„ç†ï¼‰
    â†“
ç¬¬å››é˜¶æ®µï¼šæ•°æ®åˆ†å¸ƒåˆ†æï¼ˆç»Ÿè®¡åˆ†æï¼‰
```

### 1.2 æ ¸å¿ƒç±»ç»“æ„
- **CommentDataProcessor**: ä¸»è¦å¤„ç†ç±»
- **æ–¹æ³•åˆ†ç±»**:
  - æ•°æ®è·å–: `get_raw_comments()`, `get_filtered_comments()`
  - æ•°æ®è¿‡æ»¤: `is_spam_comment()`, `filter_spam_comments()`
  - æ•°æ®æ¸…æ´—: `clean_text()`, `segment_text()`
  - æ•°æ®åˆ†æ: `analyze_data_distribution()`, `analyze_filtering_effect()`

## äºŒã€ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®å‡†å¤‡ç®—æ³•

### 2.1 åŸå§‹æ•°æ®æå–è§„åˆ™

#### ç®—æ³•ï¼š`get_raw_comments()`
**ç›®çš„**: ä»æ•°æ®åº“æå–åŸå§‹è¯„è®ºæ•°æ®ï¼Œä¸è¿›è¡Œä»»ä½•å†…å®¹è¿‡æ»¤

**SQLæŸ¥è¯¢è§„åˆ™**:
```sql
SELECT 
    comment_id, aweme_id, parent_comment_id, content, create_time, 
    like_count, sub_comment_count, user_id, nickname, user_signature
FROM douyin_aweme_comment
WHERE content IS NOT NULL
```

**æå–å­—æ®µè¯´æ˜**:
- `comment_id`: è¯„è®ºå”¯ä¸€æ ‡è¯†ç¬¦
- `aweme_id`: è§†é¢‘IDï¼Œç”¨äºå…³è”è§†é¢‘ä¿¡æ¯
- `parent_comment_id`: çˆ¶è¯„è®ºIDï¼Œç”¨äºè¯†åˆ«è¯„è®ºå±‚çº§å…³ç³»
- `content`: è¯„è®ºæ–‡æœ¬å†…å®¹
- `create_time`: Unixæ—¶é—´æˆ³ï¼Œè¯„è®ºåˆ›å»ºæ—¶é—´
- `like_count`: ç‚¹èµæ•°é‡
- `sub_comment_count`: å­è¯„è®ºæ•°é‡
- `user_id`: ç”¨æˆ·ID
- `nickname`: ç”¨æˆ·æ˜µç§°
- `user_signature`: ç”¨æˆ·ç­¾å

**æ—¶é—´è¿‡æ»¤è§„åˆ™**ï¼ˆå¯é€‰ï¼‰:
```python
if start_time:
    start_timestamp = int(start_time.timestamp())
    base_sql += f" AND create_time >= {start_timestamp}"

if end_time:
    end_timestamp = int(end_time.timestamp())
    base_sql += f" AND create_time <= {end_timestamp}"
```

**ç¤ºä¾‹**:
```python
# æå–æœ€è¿‘30å¤©çš„æ•°æ®
start_time = datetime.now() - timedelta(days=30)
df_raw = processor.get_raw_comments(conn, start_time=start_time)

# æå–æ‰€æœ‰å†å²æ•°æ®
df_raw = processor.get_raw_comments(conn)  # ä¸ä¼ æ—¶é—´å‚æ•°
```

## ä¸‰ã€ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®è¿‡æ»¤ç®—æ³•

### 3.1 åƒåœ¾è¯„è®ºè¯†åˆ«ç®—æ³•

#### ç®—æ³•ï¼š`is_spam_comment(content, user_signature)`
**ç›®çš„**: è¯†åˆ«å¹¶è¿‡æ»¤åƒåœ¾è¯„è®ºã€å¹¿å‘Šè¯„è®ºã€æœºå™¨äººè¯„è®ºç­‰ä½è´¨é‡å†…å®¹

#### 3.1.1 å†…å®¹é•¿åº¦æ£€æŸ¥
**è§„åˆ™**: å†…å®¹é•¿åº¦å°äº5ä¸ªå­—ç¬¦çš„è¯„è®ºè¢«è¿‡æ»¤
```python
if len(content.strip()) < 5:
    return True
```

**ç¤ºä¾‹**:
```python
# ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
"666"           # é•¿åº¦=3 < 5
"å¥½"            # é•¿åº¦=1 < 5
"ğŸ‘"            # é•¿åº¦=1 < 5

# ä¸ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
"çœŸä¸é”™"        # é•¿åº¦=3 < 5ï¼Œä½†stripåå¯èƒ½æ›´çŸ­
"è¿™ä¸ªè§†é¢‘å¾ˆæ£’"   # é•¿åº¦=6 >= 5
```

#### 3.1.2 ç‰¹æ®Šå­—ç¬¦æ¯”ä¾‹æ£€æŸ¥
**è§„åˆ™**: ç‰¹æ®Šå­—ç¬¦æ¯”ä¾‹è¶…è¿‡60%çš„è¯„è®ºè¢«è¿‡æ»¤
```python
special_char_ratio = len(re.findall(r'[^\u4e00-\u9fa5a-zA-Z0-9\s]', content)) / len(content)
if special_char_ratio > 0.6:
    return True
```

**æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜**:
- `[^\u4e00-\u9fa5a-zA-Z0-9\s]`: åŒ¹é…éä¸­æ–‡ã€éè‹±æ–‡ã€éæ•°å­—ã€éç©ºç™½å­—ç¬¦
- `\u4e00-\u9fa5`: ä¸­æ–‡å­—ç¬¦èŒƒå›´
- `a-zA-Z`: è‹±æ–‡å­—æ¯
- `0-9`: æ•°å­—
- `\s`: ç©ºç™½å­—ç¬¦

**ç¤ºä¾‹**:
```python
# ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
"ğŸ‰ğŸŠğŸˆğŸğŸ‚"     # ç‰¹æ®Šå­—ç¬¦æ¯”ä¾‹=100% > 60%
"666666666"     # ç‰¹æ®Šå­—ç¬¦æ¯”ä¾‹=0% <= 60%
"çœŸæ£’ğŸ‘ğŸ‘ğŸ‘"     # ç‰¹æ®Šå­—ç¬¦æ¯”ä¾‹=50% <= 60%

# ä¸ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™ï¼"  # ç‰¹æ®Šå­—ç¬¦æ¯”ä¾‹=10% <= 60%
"æ”¯æŒä¸€ä¸‹ğŸ˜Š"      # ç‰¹æ®Šå­—ç¬¦æ¯”ä¾‹=20% <= 60%
```

#### 3.1.3 å¹¿å‘Šå…³é”®è¯æ£€æŸ¥
**è§„åˆ™**: åŒ…å«å¹¿å‘Šå…³é”®è¯çš„è¯„è®ºè¢«è¿‡æ»¤

**å…³é”®è¯åˆ—è¡¨**:
```python
ad_keywords = [
    'åŠ å¾®ä¿¡', 'åŠ qq', 'åŠ ç¾¤', 'ç§ä¿¡', 'è”ç³»æˆ‘', 'åˆä½œ', 'æ¨å¹¿', 'å¹¿å‘Š',
    'èµšé’±', 'å…¼èŒ', 'ä»£ç†', 'åŠ ç›Ÿ', 'æ‹›å•†', 'æŠ•èµ„', 'ç†è´¢', 'è´·æ¬¾',
    'å…è´¹é¢†å–', 'é™æ—¶ä¼˜æƒ ', 'ç‚¹å‡»é“¾æ¥', 'æ‰«ç å…³æ³¨', 'å…³æ³¨å…¬ä¼—å·'
]
```

**æ£€æŸ¥ç®—æ³•**:
```python
content_lower = content.lower()
for keyword in ad_keywords:
    if keyword in content_lower:
        return True
```

**ç¤ºä¾‹**:
```python
# ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
"åŠ å¾®ä¿¡123456"           # åŒ…å«"åŠ å¾®ä¿¡"
"æƒ³èµšé’±çš„ç§ä¿¡æˆ‘"         # åŒ…å«"èµšé’±"å’Œ"ç§ä¿¡"
"å…è´¹é¢†å–ä¼˜æƒ åˆ¸"         # åŒ…å«"å…è´¹é¢†å–"
"æ‰«ç å…³æ³¨å…¬ä¼—å·"         # åŒ…å«"æ‰«ç å…³æ³¨"å’Œ"å…¬ä¼—å·"

# ä¸ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™"         # ä¸åŒ…å«ä»»ä½•å¹¿å‘Šå…³é”®è¯
"æˆ‘æƒ³å­¦ä¹ è¿™ä¸ªæŠ€èƒ½"       # ä¸åŒ…å«ä»»ä½•å¹¿å‘Šå…³é”®è¯
"æ”¯æŒä¸€ä¸‹ï¼Œç»§ç»­åŠ æ²¹"     # ä¸åŒ…å«ä»»ä½•å¹¿å‘Šå…³é”®è¯
```

#### 3.1.4 é‡å¤å­—ç¬¦æ£€æŸ¥
**è§„åˆ™**: é‡å¤å­—ç¬¦è¿‡å¤šçš„è¯„è®ºè¢«è¿‡æ»¤
```python
if len(set(content)) < len(content) * 0.2:
    return True
```

**ç®—æ³•è¯´æ˜**: å¦‚æœå»é‡åçš„å­—ç¬¦æ•°å°‘äºåŸå­—ç¬¦æ•°çš„20%ï¼Œåˆ™è®¤ä¸ºé‡å¤å­—ç¬¦è¿‡å¤š

**ç¤ºä¾‹**:
```python
# ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
"666666666666"          # å»é‡å="6", æ¯”ä¾‹=1/12=8.3% < 20%
"å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ"          # å»é‡å="å“ˆå“ˆ", æ¯”ä¾‹=2/6=33.3% > 20%
"ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼"        # å»é‡å="ï¼", æ¯”ä¾‹=1/8=12.5% < 20%

# ä¸ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™"        # å»é‡å="è¿™ä¸ªè§†é¢‘çœŸä¸é”™", æ¯”ä¾‹=7/7=100% > 20%
"æ”¯æŒä¸€ä¸‹ï¼Œç»§ç»­åŠ æ²¹"    # å»é‡å="æ”¯æŒä¸€ä¸‹ï¼Œç»§ç»­åŠ æ²¹", æ¯”ä¾‹=8/8=100% > 20%
```

#### 3.1.5 ç”¨æˆ·ç­¾åæ£€æŸ¥
**è§„åˆ™**: ç”¨æˆ·ç­¾åå¼‚å¸¸ï¼ˆè¿‡é•¿æˆ–åŒ…å«å¤§é‡æ•°å­—ï¼‰çš„è¯„è®ºè¢«è¿‡æ»¤
```python
if user_signature:
    if len(user_signature) > 100:
        return True
    if re.search(r'[0-9]{8,}', user_signature):
        return True
```

**æ£€æŸ¥æ¡ä»¶**:
1. ç­¾åé•¿åº¦è¶…è¿‡100ä¸ªå­—ç¬¦
2. ç­¾åä¸­åŒ…å«8ä¸ªæˆ–æ›´å¤šè¿ç»­æ•°å­—

**ç¤ºä¾‹**:
```python
# ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
user_signature = "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„ç”¨æˆ·ç­¾åï¼Œè¶…è¿‡äº†100ä¸ªå­—ç¬¦çš„é™åˆ¶ï¼Œåº”è¯¥è¢«è¿‡æ»¤æ‰..."  # é•¿åº¦>100
user_signature = "å¾®ä¿¡ï¼š12345678"  # åŒ…å«8ä¸ªè¿ç»­æ•°å­—

# ä¸ä¼šè¢«è¿‡æ»¤çš„è¯„è®º
user_signature = "çƒ­çˆ±ç”Ÿæ´»"        # é•¿åº¦=4 <= 100ï¼Œæ— è¿ç»­æ•°å­—
user_signature = "å¾®ä¿¡ï¼š1234567"   # é•¿åº¦=8 <= 100ï¼Œè¿ç»­æ•°å­—=7 < 8
```

### 3.2 è¿‡æ»¤æ•ˆæœç»Ÿè®¡
**ç®—æ³•**: `filter_spam_comments(df)`
**åŠŸèƒ½**: æ‰¹é‡åº”ç”¨åƒåœ¾è¯„è®ºè¿‡æ»¤è§„åˆ™å¹¶ç»Ÿè®¡è¿‡æ»¤æ•ˆæœ

**ç»Ÿè®¡æŒ‡æ ‡**:
- è¿‡æ»¤å‰æ•°æ®é‡
- è¿‡æ»¤åæ•°æ®é‡
- è¿‡æ»¤æ‰çš„åƒåœ¾è¯„è®ºæ•°é‡
- è¿‡æ»¤ç‡

## å››ã€ç¬¬ä¸‰é˜¶æ®µï¼šæ•°æ®æ¸…æ´—ç®—æ³•

### 4.1 æ–‡æœ¬æ¸…æ´—ç®—æ³•

#### ç®—æ³•ï¼š`clean_text(text)`
**ç›®çš„**: å¯¹è¯„è®ºæ–‡æœ¬è¿›è¡Œæ ‡å‡†åŒ–æ¸…æ´—ï¼Œå»é™¤æ— ç”¨ä¿¡æ¯

#### 4.1.1 HTMLæ ‡ç­¾å»é™¤
**è§„åˆ™**: å»é™¤æ‰€æœ‰HTMLæ ‡ç­¾
```python
text = re.sub(r'<[^>]+>', '', text)
```

**æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜**:
- `<[^>]+>`: åŒ¹é…HTMLæ ‡ç­¾
- `<`: å¼€å§‹æ ‡ç­¾
- `[^>]+`: ä¸€ä¸ªæˆ–å¤šä¸ªé>å­—ç¬¦
- `>`: ç»“æŸæ ‡ç­¾

**ç¤ºä¾‹**:
```python
# è¾“å…¥
"<b>è¿™ä¸ªè§†é¢‘</b>çœŸä¸é”™"

# è¾“å‡º
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™"
```

#### 4.1.2 URLé“¾æ¥å»é™¤
**è§„åˆ™**: å»é™¤æ‰€æœ‰HTTP/HTTPSé“¾æ¥
```python
text = re.sub(r'http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+', '', text)
```

**æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜**:
- `http[s]?://`: åŒ¹é…httpæˆ–httpsåè®®
- `(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+`: åŒ¹é…URLå­—ç¬¦

**ç¤ºä¾‹**:
```python
# è¾“å…¥
"è¿™ä¸ªè§†é¢‘å¾ˆæ£’ï¼Œé“¾æ¥ï¼šhttps://www.douyin.com/video/123456"

# è¾“å‡º
"è¿™ä¸ªè§†é¢‘å¾ˆæ£’ï¼Œé“¾æ¥ï¼š"
```

#### 4.1.3 æ–¹æ‹¬å·å†…å®¹å»é™¤
**è§„åˆ™**: å»é™¤æ–¹æ‹¬å·åŠå…¶å†…å®¹ï¼ˆå¦‚è¡¨æƒ…ç¬¦å·æ ‡ç­¾ï¼‰
```python
text = re.sub(r'\[[^\]]*\]', '', text)
```

**æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜**:
- `\[[^\]]*\]`: åŒ¹é…æ–¹æ‹¬å·åŠå…¶å†…å®¹
- `\[`: å·¦æ–¹æ‹¬å·
- `[^\]]*`: é›¶ä¸ªæˆ–å¤šä¸ªéå³æ–¹æ‹¬å·å­—ç¬¦
- `\]`: å³æ–¹æ‹¬å·

**ç¤ºä¾‹**:
```python
# è¾“å…¥
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™[666][æ¯”å¿ƒ][ç‚¹èµ]"

# è¾“å‡º
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™"
```

#### 4.1.4 ç©ºç™½å­—ç¬¦æ ‡å‡†åŒ–
**è§„åˆ™**: å°†å¤šä¸ªè¿ç»­ç©ºç™½å­—ç¬¦æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼ï¼Œå¹¶å»é™¤é¦–å°¾ç©ºç™½
```python
text = re.sub(r'\s+', ' ', text).strip()
```

**æ­£åˆ™è¡¨è¾¾å¼è¯´æ˜**:
- `\s+`: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªç©ºç™½å­—ç¬¦
- `strip()`: å»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦

**ç¤ºä¾‹**:
```python
# è¾“å…¥
"  è¿™ä¸ª    è§†é¢‘   çœŸä¸é”™  "

# è¾“å‡º
"è¿™ä¸ª è§†é¢‘ çœŸä¸é”™"
```

#### 4.1.5 å­—ç¬¦è¿‡æ»¤
**è§„åˆ™**: åªä¿ç•™ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ã€ä¸­æ–‡æ ‡ç‚¹å’Œç©ºç™½å­—ç¬¦
```python
text = re.sub(r'[^\u4e00-\u9fa5a-zA-Z0-9\s\u3000-\u303f\uff00-\uffef]', '', text)
```

**å­—ç¬¦èŒƒå›´è¯´æ˜**:
- `\u4e00-\u9fa5`: ä¸­æ–‡å­—ç¬¦
- `a-zA-Z`: è‹±æ–‡å­—æ¯
- `0-9`: æ•°å­—
- `\s`: ç©ºç™½å­—ç¬¦
- `\u3000-\u303f`: ä¸­æ–‡æ ‡ç‚¹ç¬¦å·ï¼ˆå…¨è§’ï¼‰
- `\uff00-\uffef`: å…¨è§’å­—ç¬¦

**ç¤ºä¾‹**:
```python
# è¾“å…¥
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™ï¼ğŸ‘ğŸ‰"

# è¾“å‡º
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™ï¼"
```

### 4.2 ä¸­æ–‡åˆ†è¯ç®—æ³•

#### ç®—æ³•ï¼š`segment_text(text)`
**ç›®çš„**: å¯¹æ¸…æ´—åçš„æ–‡æœ¬è¿›è¡Œä¸­æ–‡åˆ†è¯å¤„ç†

**åˆ†è¯å·¥å…·**: jiebaä¸­æ–‡åˆ†è¯åº“
**ç®—æ³•**: `jieba.lcut(text)`

**åˆ†è¯ç¤ºä¾‹**:
```python
# è¾“å…¥
"è¿™ä¸ªè§†é¢‘çœŸä¸é”™"

# åˆ†è¯ç»“æœ
['è¿™ä¸ª', 'è§†é¢‘', 'çœŸ', 'ä¸é”™']

# å»é™¤åœç”¨è¯å
['è§†é¢‘', 'ä¸é”™']  # "è¿™ä¸ª"å’Œ"çœŸ"è¢«è¯†åˆ«ä¸ºåœç”¨è¯
```

**åœç”¨è¯è¿‡æ»¤**:
```python
words = [word for word in words if word not in self.stop_words and len(word.strip()) > 0]
```

**åœç”¨è¯ç¤ºä¾‹**:
```python
stop_words = {
    'çš„', 'äº†', 'åœ¨', 'æ˜¯', 'æˆ‘', 'æœ‰', 'å’Œ', 'å°±', 'ä¸', 'äºº', 'éƒ½', 
    'ä¸€', 'ä¸€ä¸ª', 'ä¸Š', 'ä¹Ÿ', 'å¾ˆ', 'åˆ°', 'è¯´', 'è¦', 'å»', 'ä½ ', 
    'ä¼š', 'ç€', 'æ²¡æœ‰', 'çœ‹', 'å¥½', 'è‡ªå·±', 'è¿™'
}
```

### 4.3 æ—¶é—´æ ¼å¼è½¬æ¢ç®—æ³•

#### ç®—æ³•ï¼šæ—¶é—´æ ¼å¼è½¬æ¢
**ç›®çš„**: å°†Unixæ—¶é—´æˆ³è½¬æ¢ä¸ºå¯è¯»çš„æ—¶é—´æ ¼å¼

**å¤„ç†æ­¥éª¤**:
```python
# 1. è½¬æ¢ä¸ºdatetimeå¯¹è±¡
df['create_time_dt'] = pd.to_datetime(df['create_time'], unit='s')

# 2. æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²
df['create_time_str'] = df['create_time_dt'].dt.strftime('%Y-%m-%d %H:%M:%S')
```

**ç¤ºä¾‹**:
```python
# è¾“å…¥æ—¶é—´æˆ³: 1640995200
# è¾“å‡ºdatetime: 2022-01-01 00:00:00
# è¾“å‡ºå­—ç¬¦ä¸²: "2022-01-01 00:00:00"
```

## äº”ã€ç¬¬å››é˜¶æ®µï¼šæ•°æ®åˆ†æç®—æ³•

### 5.1 æ•°æ®åˆ†å¸ƒåˆ†æ

#### ç®—æ³•ï¼š`analyze_data_distribution(conn, start_time, end_time)`
**ç›®çš„**: åˆ†ææ•°æ®åº“ä¸­è¯„è®ºæ•°æ®çš„åˆ†å¸ƒç‰¹å¾

#### 5.1.1 æ€»ä½“æ•°æ®ç»Ÿè®¡
**SQLæŸ¥è¯¢**:
```sql
SELECT COUNT(*) as total FROM douyin_aweme_comment
```

**ç»Ÿè®¡æŒ‡æ ‡**: æ•°æ®åº“æ€»è¯„è®ºæ•°

#### 5.1.2 æ—¶é—´åˆ†å¸ƒåˆ†æ
**SQLæŸ¥è¯¢**:
```sql
SELECT 
    DATE(FROM_UNIXTIME(create_time)) as date,
    COUNT(*) as count
FROM douyin_aweme_comment
WHERE create_time IS NOT NULL
GROUP BY DATE(FROM_UNIXTIME(create_time))
ORDER BY date DESC
LIMIT 10
```

**ç»Ÿè®¡æŒ‡æ ‡**: æœ€è¿‘10å¤©æ¯æ—¥è¯„è®ºæ•°é‡

#### 5.1.3 å†…å®¹é•¿åº¦åˆ†å¸ƒ
**SQLæŸ¥è¯¢**:
```sql
SELECT 
    CASE 
        WHEN CHAR_LENGTH(content) < 10 THEN '0-9å­—ç¬¦'
        WHEN CHAR_LENGTH(content) < 20 THEN '10-19å­—ç¬¦'
        WHEN CHAR_LENGTH(content) < 50 THEN '20-49å­—ç¬¦'
        WHEN CHAR_LENGTH(content) < 100 THEN '50-99å­—ç¬¦'
        ELSE '100+å­—ç¬¦'
    END as length_range,
    COUNT(*) as count
FROM douyin_aweme_comment
WHERE content IS NOT NULL
GROUP BY length_range
```

**åˆ†å¸ƒåŒºé—´**:
- 0-9å­—ç¬¦: çŸ­è¯„è®º
- 10-19å­—ç¬¦: è¾ƒçŸ­è¯„è®º
- 20-49å­—ç¬¦: ä¸­ç­‰é•¿åº¦è¯„è®º
- 50-99å­—ç¬¦: è¾ƒé•¿è¯„è®º
- 100+å­—ç¬¦: é•¿è¯„è®º

#### 5.1.4 ç‚¹èµæ•°åˆ†å¸ƒ
**SQLæŸ¥è¯¢**:
```sql
SELECT 
    CASE 
        WHEN CAST(like_count AS UNSIGNED) = 0 THEN '0ç‚¹èµ'
        WHEN CAST(like_count AS UNSIGNED) < 5 THEN '1-4ç‚¹èµ'
        WHEN CAST(like_count AS UNSIGNED) < 20 THEN '5-19ç‚¹èµ'
        WHEN CAST(like_count AS UNSIGNED) < 100 THEN '20-99ç‚¹èµ'
        ELSE '100+ç‚¹èµ'
    END as likes_range,
    COUNT(*) as count
FROM douyin_aweme_comment
WHERE like_count IS NOT NULL
GROUP BY likes_range
```

**åˆ†å¸ƒåŒºé—´**:
- 0ç‚¹èµ: æ— ç‚¹èµè¯„è®º
- 1-4ç‚¹èµ: ä½ç‚¹èµè¯„è®º
- 5-19ç‚¹èµ: ä¸­ç­‰ç‚¹èµè¯„è®º
- 20-99ç‚¹èµ: é«˜ç‚¹èµè¯„è®º
- 100+ç‚¹èµ: è¶…é«˜ç‚¹èµè¯„è®º

#### 5.1.5 å­è¯„è®ºæ•°åˆ†å¸ƒ
**SQLæŸ¥è¯¢**:
```sql
SELECT 
    CASE 
        WHEN CAST(sub_comment_count AS UNSIGNED) = 0 THEN '0å­è¯„è®º'
        WHEN CAST(sub_comment_count AS UNSIGNED) < 3 THEN '1-2å­è¯„è®º'
        WHEN CAST(sub_comment_count AS UNSIGNED) < 10 THEN '3-9å­è¯„è®º'
        WHEN CAST(sub_comment_count AS UNSIGNED) < 50 THEN '10-49å­è¯„è®º'
        ELSE '50+å­è¯„è®º'
    END as sub_comments_range,
    COUNT(*) as count
FROM douyin_aweme_comment
WHERE sub_comment_count IS NOT NULL
GROUP BY sub_comments_range
```

**åˆ†å¸ƒåŒºé—´**:
- 0å­è¯„è®º: æ— å›å¤è¯„è®º
- 1-2å­è¯„è®º: ä½å›å¤è¯„è®º
- 3-9å­è¯„è®º: ä¸­ç­‰å›å¤è¯„è®º
- 10-49å­è¯„è®º: é«˜å›å¤è¯„è®º
- 50+å­è¯„è®º: è¶…é«˜å›å¤è¯„è®º

### 5.2 è¿‡æ»¤æ•ˆæœåˆ†æ

#### ç®—æ³•ï¼š`analyze_filtering_effect(conn, df_original, df_filtered)`
**ç›®çš„**: åˆ†æå„è¿‡æ»¤è§„åˆ™çš„æ•ˆæœå’Œè´¡çŒ®åº¦

#### 5.2.1 æ€»ä½“è¿‡æ»¤æ•ˆæœ
**ç»Ÿè®¡æŒ‡æ ‡**:
- æ•°æ®åº“åŸå§‹æ•°æ®é‡
- SQLè¿‡æ»¤åæ•°æ®é‡
- åƒåœ¾è¯„è®ºè¿‡æ»¤åæ•°æ®é‡
- å„é˜¶æ®µè¿‡æ»¤æ•°é‡
- æ€»è¿‡æ»¤ç‡

#### 5.2.2 å„è¿‡æ»¤æ¡ä»¶æ•ˆæœåˆ†æ
**åˆ†æç»´åº¦**:
1. å†…å®¹é•¿åº¦è¿‡æ»¤æ•ˆæœ
2. ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤æ•ˆæœ
3. å¹¿å‘Šå…³é”®è¯è¿‡æ»¤æ•ˆæœ
4. é‡å¤å­—ç¬¦è¿‡æ»¤æ•ˆæœ
5. ç”¨æˆ·ç­¾åè¿‡æ»¤æ•ˆæœ

**è®¡ç®—æ–¹æ³•**:
```python
# ä»¥å†…å®¹é•¿åº¦è¿‡æ»¤ä¸ºä¾‹
short_content = len(df_db_original[df_db_original['content'].str.len() < 5])
short_percentage = (short_content / total_db_original) * 100
```

#### 5.2.3 æ•°æ®è´¨é‡æå‡ç»Ÿè®¡
**ç»Ÿè®¡æŒ‡æ ‡**:
- å¹³å‡å†…å®¹é•¿åº¦å˜åŒ–
- ç‰¹æ®Šå­—ç¬¦æ¯”ä¾‹å˜åŒ–
- æ•°æ®è´¨é‡æå‡ç¨‹åº¦

## å…­ã€æ•°æ®è¾“å‡ºæ ¼å¼

### 6.1 ä¿å­˜å­—æ®µè¯´æ˜
**è¾“å‡ºå­—æ®µ**:
```python
save_columns = [
    'comment_id',        # è¯„è®ºID
    'aweme_id',          # è§†é¢‘ID
    'parent_comment_id', # çˆ¶è¯„è®ºID
    'content',           # åŸå§‹å†…å®¹
    'content_cleaned',   # æ¸…æ´—åå†…å®¹
    'content_segmented', # åˆ†è¯ç»“æœ
    'create_time',       # åŸå§‹æ—¶é—´æˆ³
    'create_time_dt',    # æ—¶é—´å¯¹è±¡
    'create_time_str',   # æ ¼å¼åŒ–æ—¶é—´å­—ç¬¦ä¸²
    'like_count',        # ç‚¹èµæ•°
    'sub_comment_count', # å­è¯„è®ºæ•°
    'word_count'         # åˆ†è¯æ•°é‡
]
```

### 6.2 è¾“å‡ºæ ¼å¼
**æ–‡ä»¶æ ¼å¼**: JSON
**ç¼–ç **: UTF-8
**ç»“æ„**: è®°å½•æ•°ç»„æ ¼å¼

**ç¤ºä¾‹è¾“å‡º**:
```json
[
  {
    "comment_id": "123456789",
    "aweme_id": "987654321",
    "parent_comment_id": "0",
    "content": "è¿™ä¸ªè§†é¢‘çœŸä¸é”™ï¼ğŸ‘",
    "content_cleaned": "è¿™ä¸ªè§†é¢‘çœŸä¸é”™ï¼",
    "content_segmented": ["è§†é¢‘", "ä¸é”™"],
    "create_time": 1640995200,
    "create_time_dt": "2022-01-01T00:00:00",
    "create_time_str": "2022-01-01 00:00:00",
    "like_count": 5,
    "sub_comment_count": 2,
    "word_count": 2
  }
]
```

## ä¸ƒã€é‡è¦æ›´æ–°è¯´æ˜

### 7.1 æ¨¡å—èŒè´£åˆ†ç¦»
**æ›´æ–°å†…å®¹**: æ•°æ®å‡†å¤‡å’Œæ¸…æ´—æ¨¡å—ä¸å†è´Ÿè´£æ—¶é—´å·®è®¡ç®—
- âŒ ç§»é™¤äº† `calculate_time_diff()` å‡½æ•°
- âŒ ç§»é™¤äº†æ—¶é—´å·®ç»Ÿè®¡è¾“å‡º
- âŒ ç§»é™¤äº†ä¿å­˜å­—æ®µä¸­çš„æ—¶é—´å·®å­—æ®µ

**åŸå› **: å®ç°æ¨¡å—èŒè´£åˆ†ç¦»ï¼Œæ—¶é—´å·®è®¡ç®—ç”±ä¸“é—¨çš„æ—¶é—´åˆ†ææ¨¡å—è´Ÿè´£

### 7.2 æ•°æ®æµç¨‹ä¼˜åŒ–
**æ–°çš„æ•°æ®æµç¨‹**:
```
åŸå§‹æ•°æ® â†’ æ•°æ®å‡†å¤‡å’Œæ¸…æ´— â†’ æ¸…æ´—åæ•°æ® â†’ æ—¶é—´åˆ†ææ¨¡å— â†’ æ—¶é—´å·®è®¡ç®— â†’ å¯è§†åŒ–æŠ¥å‘Š
```

**ä¼˜åŠ¿**:
- æ¨¡å—èŒè´£æ›´æ¸…æ™°
- ä»£ç å¤ç”¨æ€§æ›´å¥½
- ç»´æŠ¤æ€§æ›´å¼º
- æ‰©å±•æ€§æ›´å¥½

## å…«ã€ç®—æ³•ä¼˜åŒ–å»ºè®®

### 8.1 æ€§èƒ½ä¼˜åŒ–
1. **æ‰¹é‡å¤„ç†**: ä½¿ç”¨pandasçš„å‘é‡åŒ–æ“ä½œæ›¿ä»£å¾ªç¯
2. **æ•°æ®åº“ä¼˜åŒ–**: æ·»åŠ é€‚å½“çš„ç´¢å¼•æé«˜æŸ¥è¯¢é€Ÿåº¦
3. **å†…å­˜ç®¡ç†**: åˆ†æ‰¹å¤„ç†å¤§æ•°æ®é›†

### 8.2 å‡†ç¡®æ€§ä¼˜åŒ–
1. **è§„åˆ™è°ƒä¼˜**: æ ¹æ®å®é™…æ•°æ®åˆ†å¸ƒè°ƒæ•´è¿‡æ»¤é˜ˆå€¼
2. **å…³é”®è¯æ›´æ–°**: å®šæœŸæ›´æ–°å¹¿å‘Šå…³é”®è¯åº“
3. **åœç”¨è¯ä¼˜åŒ–**: æ ¹æ®é¢†åŸŸç‰¹ç‚¹è°ƒæ•´åœç”¨è¯åˆ—è¡¨

### 8.3 å¯æ‰©å±•æ€§ä¼˜åŒ–
1. **æ¨¡å—åŒ–è®¾è®¡**: å°†å„é˜¶æ®µç®—æ³•ç‹¬ç«‹ä¸ºå¯é…ç½®æ¨¡å—
2. **å‚æ•°åŒ–é…ç½®**: æ”¯æŒå¤–éƒ¨é…ç½®æ–‡ä»¶è°ƒæ•´ç®—æ³•å‚æ•°
3. **å¤šå¹³å°æ”¯æŒ**: æ‰©å±•æ”¯æŒå…¶ä»–ç¤¾äº¤åª’ä½“å¹³å°

## ä¹ã€æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æŠ–éŸ³è¯„è®ºæ•°æ®æ¸…æ´—çš„å®Œæ•´ç®—æ³•ä½“ç³»ï¼ŒåŒ…æ‹¬ï¼š

1. **æ•°æ®å‡†å¤‡é˜¶æ®µ**: åŸå§‹æ•°æ®æå–ï¼Œä¿æŒæ•°æ®å®Œæ•´æ€§
2. **æ•°æ®è¿‡æ»¤é˜¶æ®µ**: å¤šç»´åº¦åƒåœ¾è¯„è®ºè¯†åˆ«å’Œè¿‡æ»¤
3. **æ•°æ®æ¸…æ´—é˜¶æ®µ**: æ–‡æœ¬æ ‡å‡†åŒ–å’Œé¢„å¤„ç†
4. **æ•°æ®åˆ†æé˜¶æ®µ**: åˆ†å¸ƒç‰¹å¾åˆ†æå’Œè¿‡æ»¤æ•ˆæœè¯„ä¼°

**é‡è¦æ›´æ–°**: æ¨¡å—èŒè´£åˆ†ç¦»ï¼Œæ—¶é—´å·®è®¡ç®—åŠŸèƒ½å·²ç§»è‡³ä¸“é—¨çš„æ—¶é—´åˆ†ææ¨¡å—ï¼Œæé«˜äº†ä»£ç çš„æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤æ€§ã€‚

æ¯ä¸ªç®—æ³•éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œæ—¢ä¿è¯äº†æ•°æ®è´¨é‡ï¼Œåˆé¿å…äº†è¿‡åº¦è¿‡æ»¤ã€‚é€šè¿‡è¯¦ç»†çš„ç¤ºä¾‹è¯´æ˜ï¼Œä½¿å¾—ç®—æ³•è§„åˆ™æ›´åŠ æ¸…æ™°æ˜“æ‡‚ï¼Œä¾¿äºåç»­çš„ç»´æŠ¤å’Œä¼˜åŒ–ã€‚ 